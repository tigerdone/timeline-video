(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1080:(e,t,a)=>{Promise.resolve().then(a.bind(a,4915))},4915:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var l=a(5050),r=a(2130),s=a(4215),i=a(8413);let o=e=>{let{clip:t,trackId:a,onResize:o,onDragStart:n,onDragEnd:d}=e,[c,p]=(0,r.useState)(!1),u=(0,r.useRef)(null),g=(0,r.useRef)(null),[,m]=(0,s.i)(()=>({type:"clip",item:()=>({clip:t,trackId:a,isResizing:c}),canDrag:()=>!c,end:()=>null==d?void 0:d()}),[c]),h=()=>{p(!0),u.current=setTimeout(()=>p(!1),500)};return m(g),(0,l.jsx)(i.Resizable,{width:(t.end-t.start)*60,height:56,axis:"x",resizeHandles:["w","e"],minConstraints:[50,56],maxConstraints:[1e3,56],onResizeStart:h,onResize:(e,a)=>{let{size:l,handle:r}=a;console.log("resizing");let s=(l.width-(t.end-t.start)*60)/60,i=t.start,n=t.end;"w"===r?i=Math.min(i=Math.max(0,t.start-s),t.end-.5):n=Math.max(t.end+s,t.start+.5),o(t.id,i,n)},onResizeStop:()=>{p(!1)},handle:(e,a)=>(0,l.jsx)("div",{ref:a,onMouseDown:e=>{e.stopPropagation(),h(),null==n||n(t.id)},className:"absolute w-2 h-full bg-gray-800/50 hover:bg-gray-800/80 \n            opacity-0 group-hover:opacity-100 cursor-col-resize transition-opacity\n            ".concat("w"===e?"left-0":"right-0","\n            ").concat(c?"!opacity-100 !bg-gray-800":"")}),className:"resizable-container ".concat(c?"resizing":""),children:(0,l.jsx)("div",{ref:g,className:"\n          absolute flex items-center p-2 rounded-lg group\n          shadow-md hover:shadow-lg transition-all\n          opacity-100\n          bg-[length:auto_100%] bg-center w-full\n          bg-repeat-x\n          ".concat(c?"!ring-2 !ring-yellow-400":""),style:{left:60*t.start,width:(t.end-t.start)*60,backgroundColor:t.color,height:56,cursor:c?"col-resize":"move",backgroundImage:"url(".concat(t.url,")")},children:(0,l.jsxs)("span",{className:"text-white font-medium text-sm truncate",children:["Clip ",t.id.split("-")[1],(0,l.jsxs)("span",{className:"block text-xs font-normal opacity-75",children:[t.start.toFixed(1),"s - ",t.end.toFixed(1),"s"]})]})})})};function n(e){let{track:t,onResize:a,onDragStart:s}=e,i=(0,r.useRef)(null);return(0,l.jsx)("div",{ref:i,className:"overflow-hidden",children:(0,l.jsx)("div",{className:"relative flex item-center bg-gray-800",style:{height:80,marginTop:20},children:(0,l.jsx)("div",{className:"relative top-1 pt-2 ".concat("bg-transparent"),children:t.clips.map(e=>(0,l.jsx)(o,{clip:e,trackId:t.id,onResize:a,onDragStart:s},e.id))})})})}let d=(e,t)=>{switch(t.type){case"MOVE_CLIP":{let{clipId:a,fromTrackId:l,toTrackId:r,toTrackIndex:s,updates:i}=t.payload,o=JSON.parse(JSON.stringify(e)),n=o.find(e=>e.id===l),d=r?o.find(e=>e.id===r):o[s||0];if(!n||!d)return e;let c=n.clips.findIndex(e=>e.id===a);if(-1===c)return e;let[p]=n.clips.splice(c,1);return p={...p,...i},d.clips.push(p),o}case"RESIZE_CLIP":{let{clipId:a,start:l,end:r}=t.payload;return e.map(e=>({...e,clips:e.clips.map(e=>e.id===a?{...e,start:Math.max(0,l),end:Math.max(l+.5,r)}:e)}))}case"CREATE_TRACK":{let{position:a}=t.payload,l={id:"track-".concat(Date.now()),clips:[]},r=Math.max(0,Math.min(a,e.length));return[...e.slice(0,r),l,...e.slice(r)]}case"UPDATE_CLIP":{let{clip:a,updates:l,toTrackIndex:r,toTrackId:s}=t.payload,i=s?e.find(e=>e.id===s):e[r||0];if(void 0===i)return e;return console.log("updates",l,i),e.map(e=>e.id!==i.id?e:{...e,clips:e.clips.map(e=>a.id===e.id?{...e,...l}:e)})}case"ADD_CLIP_TO_TRACK":{let{clip:a,toTrackIndex:l,toTrackId:r}=t.payload,s=r?e.find(e=>e.id===r):e[l||0];if(void 0===s)return e;return e.map(e=>e.id===s.id?{...e,clips:[...e.clips,a].sort((e,t)=>e.start-t.start)}:e)}case"DELETE_CLIP":{let{clipId:a,trackId:l}=t.payload;return e.map(e=>e.id===l?{...e,clips:e.clips.filter(e=>e.id!==a)}:e)}default:return e}};var c=a(7863);let p={src:"/_next/static/media/dog2.046ff0a5.webp"},u={src:"/_next/static/media/dog.30fc28e5.webp",height:800,width:1067,blurDataURL:"data:image/webp;base64,UklGRkYAAABXRUJQVlA4IDoAAADwAQCdASoIAAYAAkA4JbACdAD6HM/4vAAA/ppDSXrvqYyU8wsAof/gQso/PX7wCGDDI0BKd3YnKAAA",blurWidth:8,blurHeight:6},g=()=>{let e=(0,r.useRef)(null);console.log(u);let t=()=>{},[a,s]=(0,r.useReducer)(d,[{id:"track-1",clips:[{id:"clip-1",start:0,end:5,color:"#FF6B6B",url:p.src},{id:"clip-2",start:6,end:10,color:"#4ECDC4",url:p.src}]},{id:"track-2",clips:[{id:"clip-3",start:3,end:8,color:"#45B7D1",url:p.src}]}]),i=(e,t,a)=>{s({type:"RESIZE_CLIP",payload:{clipId:e,start:t,end:a}})},o=(0,r.useCallback)((t,l)=>{let r=e.current;if(!r)return;let i=r.getBoundingClientRect(),o=l.x-i.left,n=l.y-i.top+28-48-20,d=Math.floor(n/100),c=n%100-80>0;100*a.length<n&&(c=!0,d=a.length-1),console.log("track",a),console.log("handleDrop item",t),console.log("handleDrop position",l),console.log("handleDrop rect",i),console.log("handleDrop",o,n),console.log("trackIndex",d),console.log("shouldCreateTrack",c);let p=Math.max(0,o/60),{clip:u,trackId:g}=t,m=a.findIndex(e=>e.id===g);if(c&&(s({type:"CREATE_TRACK",payload:{position:d+1}}),m=a.length),g&&-1!==m&&m!==d){s({type:"MOVE_CLIP",payload:{clipId:u.id,fromTrackId:g,toTrackIndex:d+(c?1:0),updates:{start:p,end:u.end-u.start+p}}});return}if(t.isCreate){s({type:"ADD_CLIP_TO_TRACK",payload:{toTrackIndex:d+(c?1:0),clip:{...u,start:p,end:u.end-u.start+p}}});return}s({type:"UPDATE_CLIP",payload:{toTrackIndex:d+(c?1:0),clip:u,updates:{start:p,end:u.end-u.start+p}}})},[a]),[,g]=(0,c.H)(()=>({accept:"clip",drop:(e,t)=>{let a=t.getSourceClientOffset();a&&o(e,{x:a.x,y:a.y})},collect:e=>({isOver:e.isOver()})}),[a]);g(e);let[m,h]=(0,c.H)(()=>({accept:"asset",drop:(e,t)=>{let a=t.getSourceClientOffset();a&&(console.log({x:a.x,y:a.y}),console.log(e,m),o({isResizing:!1,isCreate:!0,clip:{id:e.asset.id,start:0,end:e.asset.duration,color:e.asset.color,url:u.src}},{x:a.x,y:a.y}))},collect:e=>({isOver:e.isOver()})}),[a]);return h(e),(0,l.jsxs)("div",{ref:e,className:"timeline-container relative text-white overflow-auto h-full",children:[(0,l.jsx)("div",{className:"sticky top-0 z-10 bg-gray-900 flex items-center",style:{height:48},children:[...Array(20)].map((e,t)=>(0,l.jsxs)("div",{className:"absolute border-l border-gray-400 px-1",style:{left:60*t},children:[t,"s"]},t))}),a.map(e=>(0,l.jsx)(n,{track:e,onDrop:o,onDragStart:t,onResize:i},e.id))]})},m=e=>{let{asset:t}=e,a=(0,r.useRef)(null),[{isDragging:i},o]=(0,s.i)(()=>({type:"asset",item:{asset:t},collect:e=>({isDragging:e.isDragging()})}));return o(a),(0,l.jsx)("div",{ref:a,className:"\n        p-4 mb-2 rounded-lg cursor-move transition-all\n\n        bg-[length:auto_100%] bg-center w-full\n        bg-repeat-x\n        ".concat(i?"opacity-50 bg-gray-700":"bg-gray-800 hover:bg-gray-700"),style:{backgroundImage:"url(".concat(u.src,")")},children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded-sm mr-3",style:{backgroundColor:t.color}}),(0,l.jsx)("span",{className:"text-white text-sm",children:t.name}),(0,l.jsxs)("span",{className:"text-gray-400 text-xs ml-2",children:[t.duration,"s"]})]})})},h=e=>{let{assets:t}=e;return(0,l.jsxs)("div",{className:"min-h-dvh bg-gray-900 p-4 border-r border-gray-700",children:[(0,l.jsx)("h3",{className:"text-white text-lg mb-4",children:"媒体资源"}),(0,l.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,l.jsx)(m,{asset:e},e.id))})]})};var x=a(9944),y=a(4503);let f=[{id:"video-1",type:"video",name:"开场镜头",duration:8,color:"#FF6B6B"},{id:"video-2",type:"video",name:"城市空拍",duration:12,color:"#FF8E8E"},{id:"video-3",type:"video",name:"产品特写",duration:6,color:"#FF5252"},{id:"audio-1",type:"audio",name:"背景音乐",duration:30,color:"#4ECDC4"},{id:"audio-2",type:"audio",name:"欢呼声效",duration:4,color:"#45B7D1"},{id:"audio-3",type:"audio",name:"旁白录音",duration:15,color:"#3BAFDA"},{id:"image-1",type:"image",name:"公司LOGO",duration:5,color:"#6BFF6B"},{id:"image-2",type:"image",name:"背景底图",duration:10,color:"#8EFF8E"},{id:"image-3",type:"image",name:"产品水印",duration:3,color:"#52FF52"}],v=()=>(0,l.jsx)(y.Q,{backend:x.t2,children:(0,l.jsxs)("div",{className:"flex overflow-scroll",children:[(0,l.jsx)("div",{className:"w-1/6 bg-gray-800",children:(0,l.jsx)(h,{assets:f})}),(0,l.jsxs)("div",{className:"h-screen flex flex-col w-full",children:[(0,l.jsxs)("div",{className:"h-1/2 border-b bg-gray-700 p-4",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-gray-50",children:"上半部（50%）"}),(0,l.jsx)("p",{className:"text-gray-50",children:"默认占满视口高度的 50%"})]}),(0,l.jsx)("div",{className:"h-1/2 overflow-y-auto  bg-gray-900 ",children:(0,l.jsx)("div",{className:"pl-4 space-y-2  h-full",children:(0,l.jsx)(g,{})})})]})]})})}},e=>{var t=t=>e(e.s=t);e.O(0,[580,777,435,358],()=>t(1080)),_N_E=e.O()}]);